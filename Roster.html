<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Roster PPA Mart 2026</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@media (max-width: 768px) {
  body { font-size: 11px; }
  td, th { padding: 3px 4px; }
}

th, td { white-space: nowrap; }

/* ================= STICKY ================= */

/* Header atas */
.sticky-top {
  position: sticky;
  top: 0;
  z-index: 40;
  background: #e5e7eb;
}

/* Kolom kiri */
.col-nik {
  position: sticky;
  left: 0;
  z-index: 60;
  background: #f9fafb;
  text-align: center;
  font-size: 11px;
  min-width: 80px;
  max-width: 80px;
}

.col-nama {
  position: sticky;
  left: 80px;
  z-index: 60;
  background: #fbf9f9;
  text-align: left !important;
  font-weight: 600;
  min-width: 160px;
}

/* ================= SHIFT COLORS ================= */

.shift-P   { background:#016bfe; color:#fff; border:1px solid #222; }
.shift-S   { background:#02f902; color:#000; border:1px solid #222; }
.shift-M   { background:#fed669; color:#000; border:1px solid #222; }
.shift-C   { background:#747475; color:#fff; border:1px solid #222; }
.shift-OFF { background:#fa0202; color:#fff; border:1px solid #222; }
.shift-STND{ background:#fafaf9; color:#000; border:1px solid #222; }
.shift-INDUKSI{ background:#02f902; color:#000; border:1px solid #222; }

.shift-PMO { background:#0f766e; color:#fff; border:1px solid #222; }
.shift-POP { background:#fde047; color:#000; border:1px solid #222; }
.shift-PMP { background:#fb923c; color:#000; border:1px dashed #222; }
.shift-SMP { background:#7c3aed; color:#fff; border:1px dashed #222; }
.shift-MOP { background:#ffffff; color:#000; border:1px dashed #222; }

/* HIGHLIGHT HARI INI — BORDER SAJA */
.today-header {
  border-left: 3px solid #dc2626 !important;
  border-right: 3px solid #dc2626 !important;
  font-weight: 700;
}

.today-col {
  border-left: 3px solid #dc2626 !important;
  border-right: 3px solid #dc2626 !important;
}

/* ================= BODY ================= */
</style>
</head>

<body class="p-4 text-xs"
style="
  background-color:#f4f6f8;
  background-image:
    repeating-linear-gradient(
      45deg,
      rgba(0,0,0,0.02) 0,
      rgba(0,0,0,0.02) 1px,
      transparent 1px,
      transparent 4px
    );
">

<!-- HEADER -->
<div class="flex items-center gap-3 mb-3">
  <img src="Logo PPA Mart.png" alt="PPA Mart" class="h-14 object-contain">
  <div>
    <h1 class="text-xl font-bold leading-tight">Roster PPA Mart 2026</h1>
    <div class="text-xs text-gray-500">Koperasi Karyawan PPA Sejahtera</div>
  </div>
</div>

<!-- LEGEND SHIFT -->
<div class="flex flex-wrap gap-2 mb-2 text-xs">
  <span class="shift-P px-2 py-1 rounded">P = Pagi</span>
  <span class="shift-S px-2 py-1 rounded">S = Sore</span>
  <span class="shift-M px-2 py-1 rounded">M = Middle</span>
  <span class="shift-C px-2 py-1 rounded">C = Cuti</span>
  <span class="shift-OFF px-2 py-1 rounded">OFF</span>
  <span class="shift-STND px-2 py-1 rounded">STND</span>
  <span class="shift-INDUKSI px-2 py-1 rounded">INDUKSI</span>
</div>

<!-- LEGEND KODE -->
<div class="flex flex-wrap gap-4 mb-3 text-xs text-gray-700">
  <span><b>MO</b> Main Office</span>
  <span><b>MP</b> Manpower</span>
  <span><b>OP</b> Office Plant</span>
</div>

<div class="overflow-auto bg-white rounded shadow max-h-[80vh]">
  <div class="flex gap-4 mb-2 text-xs text-gray-600 px-1">
    <div>Periode: <b>Januari 2026</b></div>
    <div id="lastUpdated">Last updated: memuat...</div>
  </div>

  <table id="rosterTable" class="border-collapse"></table>

  <button id="downloadKasir"
    class="m-2 px-3 py-1 text-xs rounded bg-blue-700 text-white hover:bg-blue-800">
    ⬇ Download Kasir (CSV)
  </button>

  <div class="mt-3 border-t pt-2 text-xs text-gray-700 px-2">
    <b>Keterangan Jam Kerja:</b>
    <ul class="list-disc pl-5 mt-1 space-y-1">
      <li>P : 05.00 – 16.00</li>
      <li>P MP / OP : 06.00 – 17.00</li>
      <li>P MO : 07.00 – 18.00</li>
      <li>M : 08.00 – 19.00</li>
      <li>M OP : 17.00 – 04.00</li>
      <li>S : 11.00 – 22.00</li>
      <li>S MP : 10.30 – 21.30</li>
      <li>STND : 09.00 – 20.00</li>
      <li>INDUKSI : 11.00 – 22.00</li>
    </ul>
  </div>
</div>

<script>
fetch('Roster.csv')
.then(res => res.text())
.then(text => {
  const rows = text.trim().split('\n').map(r => r.split(';').map(c => c.trim()));
  const table = document.getElementById('rosterTable');
  const today = new Date().getDate().toString();

  let html = '<thead><tr class="sticky-top">';

  rows[0].forEach((h,i)=>{
    if(i===0) html+=`<th class="col-nik border">NIK</th>`;
    else if(i===1) html+=`<th class="col-nama border">NAMA</th>`;
    else html+=`<th class="border text-center ${h===today?'today-header':''}">${h}</th>`;
  });

  html+='</tr></thead><tbody>';

  rows.slice(1).forEach(row=>{
    const sec=row[0]?.toUpperCase();
    if(['KASIR','OPERASIONAL','BACK OFFICE'].includes(sec)){
      html+=`<tr class="bg-slate-800 text-white">
        <td colspan="${rows[0].length}" class="px-3 py-2 font-bold">${sec}</td></tr>`;
      return;
    }
    html+='<tr>';
    row.forEach((cell,i)=>{
      let cls='border text-center';
      if(i===0) cls+=' col-nik';
      if(i===1) cls+=' col-nama';
      if(i>1){
        cls+=` shift-${cell.replace(/\s/g,'')}`;
        if(rows[0][i]===today) cls+=' today-col';
      }
      html+=`<td class="${cls}">${cell}</td>`;
    });
    html+='</tr>';
  });

  html+='</tbody>';
  table.innerHTML=html;
});
</script>

<script>
fetch('Roster.csv',{cache:'no-store'}).then(res=>{
  const lm=res.headers.get('Last-Modified');
  document.getElementById('lastUpdated').innerText=
    'Last updated: '+(lm?new Date(lm).toLocaleString('id-ID'):'baru saja');
});
</script>

<script>
document.getElementById('downloadKasir').onclick=()=>{
fetch('Roster.csv').then(r=>r.text()).then(t=>{
const r=t.trim().split('\n').map(x=>x.split(';'));
let out=[r[0].join(';')],ok=false;
r.slice(1).forEach(x=>{
const c=x[0]?.toUpperCase();
if(c==='KASIR'){ok=true;return;}
if(['OPERASIONAL','BACK OFFICE'].includes(c))ok=false;
if(ok) out.push(x.join(';'));
});
const b=new Blob([out.join('\n')],{type:'text/csv'});
const a=document.createElement('a');
a.href=URL.createObjectURL(b);
a.download='Roster_Kasir_2026.csv';
a.click();
});
};
</script>

</body>
</html>
